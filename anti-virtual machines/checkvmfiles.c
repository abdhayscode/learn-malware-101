/*
 * Learn Malware Dev with Uncle Hay
 * checkvmfiles.c - Anti-Virtual Machines tricks PoC
 * This code main purpose is to search for Virtual Machines (VMS files)
 * Programmer : unclehay  
*/

#include <windows.h>
#include <stdio.h>

BOOL checkVM() {
    // Files to check
    LPCSTR file01 = "c:\\windows\\system32\\drivers\\VBoxMouse.sys";
    LPCSTR file02 = "c:\\windows\\system32\\drivers\\VBoxGuest.sys";

    DWORD attributes01 = GetFileAttributes(file01);
    DWORD attributes02 = GetFileAttributes(file02);

    // check if those files exists
    if ( (attributes01 != INVALID_FILE_ATTRIBUTES && !(attributes01 & FILE_ATTRIBUTE_DIRECTORY)) || 
    (attributes02 != INVALID_FILE_ATTRIBUTES && !(attributes02 & FILE_ATTRIBUTE_DIRECTORY)) ) {
        // Any files exists
        return TRUE;
    } else {
        return FALSE; // files not found
    }
}

int main() {
    if (checkVM()) {
        printf(" ### Virtual Machines detected ### \n");
    } else {
        printf("System is NOT VMs, continue with hacking activities .... hehehehe");
    }

    return 0;
}
